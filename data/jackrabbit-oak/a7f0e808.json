{
  "files": 1, 
  "nb_test": 467, 
  "nb_error": 146, 
  "classification": {
    "singleLine": false
  }, 
  "failing_tests": [
    "testInvalidImpersonation(org.apache.jackrabbit.oak.security.authentication.DefaultLoginModuleTest)", 
    "testUserLogin(org.apache.jackrabbit.oak.security.authentication.DefaultLoginModuleTest)", 
    "testSelfImpersonation(org.apache.jackrabbit.oak.security.authentication.DefaultLoginModuleTest)", 
    "testTokenCreationAndLogin(org.apache.jackrabbit.oak.security.authentication.TokenDefaultLoginModuleTest): Invalid token ''", 
    "testValidTokenCredentials(org.apache.jackrabbit.oak.security.authentication.TokenDefaultLoginModuleTest)", 
    "testAuthenticateSimpleCredentials(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateSimpleCredentials(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateInvalidImpersonationCredentials(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateInvalidImpersonationCredentials(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateImpersonationCredentials(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateImpersonationCredentials(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateImpersonationCredentials2(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateImpersonationCredentials2(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateWithoutUserManager(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateWithoutUserManager(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateWithoutUserId(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateWithoutUserId(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateInvalidCredentials(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateInvalidCredentials(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateInvalidSimpleCredentials(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateInvalidSimpleCredentials(org.apache.jackrabbit.oak.security.authentication.user.UserAuthenticationTest)", 
    "testAuthenticateWithoutTokenProvider(org.apache.jackrabbit.oak.security.authentication.token.TokenAuthenticationTest)", 
    "testAuthenticateWithoutTokenProvider(org.apache.jackrabbit.oak.security.authentication.token.TokenAuthenticationTest)", 
    "testAuthenticateWithInvalidCredentials(org.apache.jackrabbit.oak.security.authentication.token.TokenAuthenticationTest)", 
    "testAuthenticateWithInvalidCredentials(org.apache.jackrabbit.oak.security.authentication.token.TokenAuthenticationTest)", 
    "testAuthenticateWithInvalidTokenCredentials(org.apache.jackrabbit.oak.security.authentication.token.TokenAuthenticationTest)", 
    "testAuthenticateWithInvalidTokenCredentials(org.apache.jackrabbit.oak.security.authentication.token.TokenAuthenticationTest)", 
    "testAuthenticate(org.apache.jackrabbit.oak.security.authentication.token.TokenAuthenticationTest)", 
    "testAuthenticate(org.apache.jackrabbit.oak.security.authentication.token.TokenAuthenticationTest)", 
    "testGetTokenInfoBeforeAuthenticate(org.apache.jackrabbit.oak.security.authentication.token.TokenAuthenticationTest)", 
    "testGetTokenInfoBeforeAuthenticate(org.apache.jackrabbit.oak.security.authentication.token.TokenAuthenticationTest)", 
    "testGetTokenInfoAfterAuthenticate(org.apache.jackrabbit.oak.security.authentication.token.TokenAuthenticationTest)", 
    "testGetTokenInfoAfterAuthenticate(org.apache.jackrabbit.oak.security.authentication.token.TokenAuthenticationTest)", 
    "testGetTokenInfoFromInvalidToken(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testGetTokenInfoFromInvalidToken(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testGetTokenInfo(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testGetTokenInfo(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testRemoveTokenInvalidInfo(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testRemoveTokenInvalidInfo(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testRemoveToken(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testRemoveToken(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testRemoveToken2(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testRemoveToken2(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testRemoveTokenRemovesNode(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testRemoveTokenRemovesNode(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testResetTokenExpirationInvalidToken(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testResetTokenExpirationInvalidToken(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testResetTokenExpirationExpiredToken(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testResetTokenExpirationExpiredToken(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testResetTokenExpiration(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testResetTokenExpiration(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testTokenNode(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testTokenNode(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testDoCreateToken(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testDoCreateToken(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testCreateTokenFromInvalidCredentials(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testCreateTokenFromInvalidCredentials(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testCreateTokenFromCredentials(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testCreateTokenFromCredentials(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testCreateTokenFromInvalidUserId(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testCreateTokenFromInvalidUserId(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testCreateTokenFromUserId(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testCreateTokenFromUserId(org.apache.jackrabbit.oak.security.authentication.token.TokenProviderImplTest)", 
    "testGetUserId(org.apache.jackrabbit.oak.security.authentication.token.TokenInfoTest)", 
    "testGetUserId(org.apache.jackrabbit.oak.security.authentication.token.TokenInfoTest)", 
    "testGetToken(org.apache.jackrabbit.oak.security.authentication.token.TokenInfoTest)", 
    "testGetToken(org.apache.jackrabbit.oak.security.authentication.token.TokenInfoTest)", 
    "testIsExpired(org.apache.jackrabbit.oak.security.authentication.token.TokenInfoTest)", 
    "testIsExpired(org.apache.jackrabbit.oak.security.authentication.token.TokenInfoTest)", 
    "testMatches(org.apache.jackrabbit.oak.security.authentication.token.TokenInfoTest)", 
    "testMatches(org.apache.jackrabbit.oak.security.authentication.token.TokenInfoTest)", 
    "testGetAttributes(org.apache.jackrabbit.oak.security.authentication.token.TokenInfoTest)", 
    "testGetAttributes(org.apache.jackrabbit.oak.security.authentication.token.TokenInfoTest)", 
    "testValidTokenCredentials(org.apache.jackrabbit.oak.security.authentication.TokenLoginModuleTest)", 
    "testEveryone(org.apache.jackrabbit.oak.security.principal.PrincipalProviderImplTest)", 
    "removePassword(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "removePassword(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "removePrincipalName(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "removePrincipalName(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "removeAuthorizableId(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "removeAuthorizableId(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "createWithoutPrincipalName(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "createWithoutPrincipalName(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "createWithInvalidUUID(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "createWithInvalidUUID(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "changeUUID(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "changeUUID(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "changePrincipalName(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "changePrincipalName(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "changeAuthorizableId(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "changeAuthorizableId(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "changePasswordToPlainText(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "changePasswordToPlainText(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "testRemoveAdminUser(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "testRemoveAdminUser(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "testDisableAdminUser(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "testDisableAdminUser(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "testEnforceHierarchy(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "testEnforceHierarchy(org.apache.jackrabbit.oak.security.user.UserValidatorTest)", 
    "setPasswordNull(org.apache.jackrabbit.oak.security.user.UserManagerImplTest)", 
    "testGetPasswordHash(org.apache.jackrabbit.oak.security.user.UserManagerImplTest)", 
    "testEnforceAuthorizableFolderHierarchy(org.apache.jackrabbit.oak.security.user.UserManagerImplTest)", 
    "testSetPassword(org.apache.jackrabbit.oak.security.user.UserManagerImplTest)", 
    "testSetMultiValueProperty(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testSetMultiValueProperty(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testSetPropertyByRelPath(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testSetPropertyByRelPath(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testSetProperty(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testSetProperty(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testSetPropertyInvalidRelativePath(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testSetPropertyInvalidRelativePath(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testGetPropertyByInvalidRelativePath(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testGetPropertyByInvalidRelativePath(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testHasPropertyByInvalidRelativePath(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testHasPropertyByInvalidRelativePath(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testGetPropertyNames(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testGetPropertyNames(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testGetPropertyNamesByRelPath(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testGetPropertyNamesByRelPath(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testGetPropertyNamesByInvalidRelPath(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testGetPropertyNamesByInvalidRelPath(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testGetNotExistingProperty(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testGetNotExistingProperty(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testRemoveNotExistingProperty(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testRemoveNotExistingProperty(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testSetSpecialProperties(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testSetSpecialProperties(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testRemoveSpecialProperties(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testRemoveSpecialProperties(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testSingleToMultiValued(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testSingleToMultiValued(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testMultiValuedToSingle(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testMultiValuedToSingle(org.apache.jackrabbit.oak.security.user.OakAuthorizablePropertyTest)", 
    "testSyncCreateUser(org.apache.jackrabbit.oak.spi.security.authentication.external.ExternalLoginModuleTest): java.lang.NullPointerException", 
    "testSyncCreateUserAndGroups(org.apache.jackrabbit.oak.spi.security.authentication.external.ExternalLoginModuleTest): java.lang.NullPointerException", 
    "testSyncUpdate(org.apache.jackrabbit.oak.spi.security.authentication.external.ExternalLoginModuleTest)", 
    "testSyncUpdate(org.apache.jackrabbit.oak.spi.security.authentication.external.ExternalLoginModuleTest)", 
    "testSyncUpdateAndGroups(org.apache.jackrabbit.oak.spi.security.authentication.external.ExternalLoginModuleTest)", 
    "testSyncUpdateAndGroups(org.apache.jackrabbit.oak.spi.security.authentication.external.ExternalLoginModuleTest)", 
    "testDefaultSync(org.apache.jackrabbit.oak.spi.security.authentication.external.ExternalLoginModuleTest): java.lang.NullPointerException", 
    "testPasswordValidationActionOnChange(org.apache.jackrabbit.oak.spi.security.user.action.PasswordValidationActionTest)", 
    "testPasswordValidationActionOnChange(org.apache.jackrabbit.oak.spi.security.user.action.PasswordValidationActionTest)", 
    "testActionIsCalled(org.apache.jackrabbit.oak.spi.security.user.action.PasswordValidationActionTest)", 
    "testActionIsCalled(org.apache.jackrabbit.oak.spi.security.user.action.PasswordValidationActionTest)", 
    "testPasswordValidationActionOnCreate(org.apache.jackrabbit.oak.spi.security.user.action.PasswordValidationActionTest)", 
    "testPasswordValidationActionOnCreate(org.apache.jackrabbit.oak.spi.security.user.action.PasswordValidationActionTest)"
  ], 
  "patch": "diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/commit/ValidatingHook.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/commit/ValidatingHook.java\nindex b3d10b3..7840eca 100644\n--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/commit/ValidatingHook.java\n+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/commit/ValidatingHook.java\n@@ -151,7 +151,19 @@ public void propertyDeleted(PropertyState before) {\n \n         @Override\n         public void childNodeAdded(String name, NodeState after) {\n-            childNodeChanged(name, EMPTY_NODE, after);\n+            if (NodeStateUtils.isHidden(name)) {\n+                return;\n+            }\n+            if (exception == null) {\n+                try {\n+                    Validator v = validator.childNodeAdded(name, after);\n+                    if (v != null) {\n+                        validate(v, EMPTY_NODE, after);\n+                    }\n+                } catch (CommitFailedException e) {\n+                    exception = e;\n+                }\n+            }\n         }\n \n         @Override\n@@ -175,7 +187,19 @@ public void childNodeChanged(\n \n         @Override\n         public void childNodeDeleted(String name, NodeState before) {\n-            childNodeChanged(name, before, EMPTY_NODE);\n+            if (NodeStateUtils.isHidden(name)) {\n+                return;\n+            }\n+            if (exception == null) {\n+                try {\n+                    Validator v = validator.childNodeDeleted(name, before);\n+                    if (v != null) {\n+                        validate(v, before, EMPTY_NODE);\n+                    }\n+                } catch (CommitFailedException e) {\n+                    exception = e;\n+                }\n+            }\n         }\n \n     }\n", 
  "project": "jackrabbit-oak", 
  "linesAdd": 26, 
  "jira_id": "478", 
  "nb_skipped": 0, 
  "commit": "a7f0e808", 
  "nb_failure": 0, 
  "linesRem": 2
}