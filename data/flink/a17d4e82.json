{
  "files": 6, 
  "nb_test": 719, 
  "nb_error": 0, 
  "classification": {
    "singleLine": false
  }, 
  "failing_tests": [
    "SpillableSubpartitionTest>SubpartitionTestBase.testReleaseParentAfterSpilled:88->SubpartitionTestBase.verifyViewReleasedAfterParentRelease:111 null", 
    "SpillableSubpartitionTest>SubpartitionTestBase.testReleaseParent:80->SubpartitionTestBase.verifyViewReleasedAfterParentRelease:111 null"
  ], 
  "patch": "diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/PipelinedSubpartition.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/PipelinedSubpartition.java\nindex 931790a..3b7a2a6 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/PipelinedSubpartition.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/PipelinedSubpartition.java\n@@ -41,7 +41,7 @@\n \tprivate boolean isFinished;\n \n \t/** Flag indicating whether the subpartition has been released. */\n-\tprivate boolean isReleased;\n+\tprivate volatile boolean isReleased;\n \n \t/**\n \t * A data availability listener. Registered, when the consuming task is faster than the\n@@ -167,6 +167,11 @@ public int releaseMemory() {\n \t}\n \n \t@Override\n+\tpublic boolean isReleased() {\n+\t\treturn isReleased;\n+\t}\n+\n+\t@Override\n \tpublic PipelinedSubpartitionView createReadView(BufferProvider bufferProvider) {\n \t\tsynchronized (buffers) {\n \t\t\tif (readView != null) {\ndiff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/ResultSubpartition.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/ResultSubpartition.java\nindex e9dfe32..b7ca9c4 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/ResultSubpartition.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/ResultSubpartition.java\n@@ -81,4 +81,6 @@ protected Throwable getFailureCause() {\n \n \tabstract int releaseMemory() throws IOException;\n \n+\tabstract public boolean isReleased();\n+\n }\ndiff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpillableSubpartition.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpillableSubpartition.java\nindex 4a18691..21e9cc6 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpillableSubpartition.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpillableSubpartition.java\n@@ -59,7 +59,7 @@\n \tprivate boolean isFinished;\n \n \t/** Flag indicating whether the subpartition has been released. */\n-\tboolean isReleased;\n+\tprivate volatile boolean isReleased;\n \n \t/** The read view to consume this subpartition. */\n \tprivate ResultSubpartitionView readView;\n@@ -168,6 +168,11 @@ public int releaseMemory() throws IOException {\n \t}\n \n \t@Override\n+\tpublic boolean isReleased() {\n+\t\treturn isReleased;\n+\t}\n+\n+\t@Override\n \tpublic ResultSubpartitionView createReadView(BufferProvider bufferProvider) throws IOException {\n \t\tsynchronized (buffers) {\n \t\t\tif (!isFinished) {\ndiff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpillableSubpartitionView.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpillableSubpartitionView.java\nindex 972e34b..c9da40a 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpillableSubpartitionView.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpillableSubpartitionView.java\n@@ -73,7 +73,7 @@ public Buffer getNextBuffer() throws IOException, InterruptedException {\n \n \t\t// 1) In-memory\n \t\tsynchronized (parent.buffers) {\n-\t\t\tif (parent.isReleased) {\n+\t\t\tif (parent.isReleased()) {\n \t\t\t\treturn null;\n \t\t\t}\n \n@@ -162,7 +162,7 @@ public void releaseAllResources() throws IOException {\n \n \t@Override\n \tpublic boolean isReleased() {\n-\t\treturn isReleased.get();\n+\t\treturn parent.isReleased() || isReleased.get();\n \t}\n \n \t@Override\ndiff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpilledSubpartitionViewAsyncIO.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpilledSubpartitionViewAsyncIO.java\nindex ea5c20b..052a7cd 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpilledSubpartitionViewAsyncIO.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpilledSubpartitionViewAsyncIO.java\n@@ -187,7 +187,7 @@ public void releaseAllResources() throws IOException {\n \n \t@Override\n \tpublic boolean isReleased() {\n-\t\treturn isReleased;\n+\t\treturn parent.isReleased() || isReleased;\n \t}\n \n \t@Override\ndiff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpilledSubpartitionViewSyncIO.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpilledSubpartitionViewSyncIO.java\nindex 24099a7..5b91668 100644\n--- a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpilledSubpartitionViewSyncIO.java\n+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SpilledSubpartitionViewSyncIO.java\n@@ -108,7 +108,7 @@ public void releaseAllResources() throws IOException {\n \n \t@Override\n \tpublic boolean isReleased() {\n-\t\treturn isReleased.get();\n+\t\treturn parent.isReleased() || isReleased.get();\n \t}\n \n \t@Override\n", 
  "project": "flink", 
  "linesAdd": 18, 
  "jira_id": "2460", 
  "nb_skipped": 0, 
  "commit": "a17d4e82", 
  "nb_failure": 2, 
  "linesRem": 6
}